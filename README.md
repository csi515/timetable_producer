# 🎓 시간표 제작 시스템 (Timetable Producer)

학교 시간표를 자동으로 생성하는 웹 기반 도구입니다. 교사 배정, 제약 조건 설정, 공동수업 관리 등 다양한 기능을 제공하여 효율적인 시간표 제작을 지원합니다.

## ✨ 주요 기능

### 📋 단계별 설정
- **기본 설정**: 학년 수, 학급 수, 일일 교시 수 설정
- **과목 설정**: 과목별 주간 시수, 특별실 필요 여부, 공동수업 필요 여부 설정
- **교사 설정**: 교사별 담당 과목, 주간 근무 시간, 학급별 시수 설정
- **제약 조건**: 필수/선택적 제약 조건 설정
- **고정 수업**: 특정 시간에 고정할 수업 설정
- **최종 확인**: 설정 내용 검토 및 수정

### 🤖 자동 시간표 생성
- **스마트 스케줄링**: 교사 배정, 제약 조건을 고려한 자동 시간표 생성
- **공동수업 관리**: 여러 교사가 함께 진행하는 수업 자동 배정
- **교사 시수 검증**: 교사의 총 주간시수와 학급별 요구시수 일치 여부 검증 (공동수업 고려)
- **빈 시간 채우기**: 미배정 시간 자동 채우기
- **교사 시간 균형**: 교사별 주간 근무 시간 자동 조정

### 🔒 엄격한 제약조건 적용 시스템

### 개요
시간표 생성 시스템이 모든 제약조건을 엄격하게 준수하도록 개선되었습니다. 제약조건 위반이 발생하면 시간표 생성을 중단하고 상세한 위반 보고서를 제공합니다.

### 🔍 시간표 디버깅 시스템

#### 전체 디버깅 기능
시간표 생성 결과를 체계적으로 검토하여 모든 제약조건 준수 여부를 확인합니다.

**검증 항목:**
1. **교사별 수업 가능 시간 검증**: 교사가 지정된 가능한 시간 외에 수업이 배정되지 않았는지 확인
2. **교사별 주간 수업 시수 검증**: 교사별 주간 수업 시수가 설정한 최대치를 초과하지 않았는지 확인
3. **학급별 주간 수업 시수 검증**: 학급별 주간 수업 시수가 정확하게 배정되었는지 확인
4. **블록제 수업 연속 배정 검증**: 블록제 수업이 올바르게 연속 2교시로 배정되었는지 확인
5. **공동수업 조건 검증**: 공동수업 조건이 지켜졌는지 확인
6. **교사 동시 배정 검증**: 동일 시간에 한 교사가 두 반에 동시에 배정되어 있지는 않은지 확인
7. **중복/누락 수업 검증**: 중복 수업이나 누락된 수업은 없는지 확인

**출력 형식:**
- ✅ 조건 만족: 제약조건이 올바르게 준수됨
- ❌ 위반 발견: 구체적인 위반 내용과 함께 오류 메시지 출력

### 주요 개선사항

#### 1. 교사별 수업 가능 시간 강제 적용
- **기능**: 교사가 지정된 가능한 시간(`available_times`) 외에는 절대 수업이 배정되지 않음
- **검증**: 배치 전 모든 시간에 대해 가능 여부 확인
- **처리**: 불가능한 시간에 배정 시도 시 즉시 중단

#### 2. 학급별 주간 수업 시수 엄격 제한
- **기능**: 각 학급별 설정된 주간 수업 시수(`classWeeklyHours`)를 절대 초과하지 않음
- **검증**: 배치 전 현재 시수와 제한 시수 비교
- **처리**: 초과 시 배정 중단 및 오류 메시지 출력

#### 3. 통합 제약조건 검증
- **기능**: 모든 제약조건을 한 번에 검증하는 통합 함수
- **검증 항목**:
  - 교사별 수업 가능 시간
  - 교사 시간 충돌
  - 학급별 주간 수업 시수
  - 블록제 수업 제약조건
  - 슬롯 배치 기본 검증

#### 4. 재조정 로직 완전 제거
- **기존 문제**: 제약조건을 무시하는 자동 재조정으로 인한 위반
- **개선사항**: 모든 재조정 로직 제거
- **결과**: 제약조건 위반 시 생성 중단

#### 5. 상세한 위반 보고서
- **기능**: 제약조건 위반 시 구체적인 위반 내용과 해결 방안 제시
- **제공 정보**:
  - 위반된 제약조건 목록
  - 구체적인 위반 내용
  - 권장 해결 방안

### 사용법

#### 교사별 수업 가능 시간 설정
```typescript
// Teacher 타입에 available_times 필드 추가
interface Teacher {
  name: string;
  available_times?: [string, number][]; // [day, period]
  // ... 기타 필드
}

// 예시: 월요일 1-3교시, 화요일 2-4교시만 가능
const teacher = {
  name: "김교사",
  available_times: [
    ["월", 1], ["월", 2], ["월", 3],
    ["화", 2], ["화", 3], ["화", 4]
  ]
};
```

#### 학급별 주간 수업 시수 설정
```typescript
// TimetableData의 classWeeklyHours 설정
const data = {
  classWeeklyHours: {
    "1학년 1반": 30,
    "1학년 2반": 28,
    "2학년 1반": 32
  }
};
```

#### 시간표 디버깅 실행
```typescript
// 독립적 디버깅 실행
import { debugTimetableIndependently } from './core/constraints';

const debugResult = debugTimetableIndependently(schedule, data, addLog);
if (!debugResult.isValid) {
  console.log('위반 사항:', debugResult.violations);
}
```

### 오류 처리

#### 제약조건 위반 시 동작
1. **즉시 중단**: 위반 발견 시 시간표 생성 중단
2. **상세 보고**: 위반된 제약조건과 구체적인 내용 표시
3. **해결 방안**: 권장 해결 방법 제시
4. **에러 메시지**: 사용자에게 명확한 안내

#### 예시 오류 메시지
```
🚨 제약조건 위반이 발견되었습니다. 시간표 생성을 중단합니다.
📋 총 3개의 제약조건 위반이 발견되었습니다.

위반된 제약조건:
  1. 김교사는 월요일 5교시에 수업할 수 없습니다 (가능 시간 제한).
  2. 1학년 1반 주간 수업 시수 초과: 31시간 > 30시간
  3. 이교사가 화요일 3교시에 1학년 1반, 1학년 2반에서 동시에 수업 중입니다.

권장사항:
  • 교사별 수업 가능 시간을 확인하고 조정하세요.
  • 학급별 주간 수업 시수를 확인하고 조정하세요.
  • 교사 시수 제한을 확인하고 조정하세요.
```

#### 예시 디버깅 결과
```
🔍 시간표 생성 결과 전체 디버깅을 시작합니다...

1️⃣ 교사별 수업 가능 시간 검증
✅ 조건 만족

2️⃣ 교사별 주간 수업 시수 검증
❌ 김교사 시수 초과: 25시간 > 22시간
❌ 이교사 1학년 1반 학급 시수 초과: 8시간 > 6시간

3️⃣ 학급별 주간 수업 시수 검증
✅ 조건 만족

4️⃣ 블록제 수업 연속 배정 검증
❌ 1학년 1반 월요일 3교시와 5교시에 블록제 교사가 배정되었지만 연속되지 않습니다.

5️⃣ 공동수업 조건 검증
✅ 조건 만족

6️⃣ 교사 동시 배정 검증
✅ 조건 만족

7️⃣ 중복/누락 수업 검증
❌ 1학년 1반 수학 과목 중복 배정: 5시간 > 4시간
❌ 1학년 2반 영어 과목 누락: 2시간 < 3시간

📊 디버깅 결과 요약
❌ 총 4개의 제약조건 위반이 발견되었습니다.
위반된 항목들:
  1. 김교사 시수 초과: 25시간 > 22시간
  2. 이교사 1학년 1반 학급 시수 초과: 8시간 > 6시간
  3. 1학년 1반 월요일 3교시와 5교시에 블록제 교사가 배정되었지만 연속되지 않습니다.
  4. 1학년 1반 수학 과목 중복 배정: 5시간 > 4시간
  5. 1학년 2반 영어 과목 누락: 2시간 < 3시간
```

### 기존 시스템과의 차이점

| 구분 | 기존 시스템 | 개선된 시스템 |
|------|-------------|---------------|
| 제약조건 적용 | 부분적 적용, 재조정으로 우회 | 엄격한 적용, 위반 시 중단 |
| 교사 가능 시간 | 권고사항 수준 | 강제 적용 |
| 학급 시수 제한 | 초과 시 경고만 | 초과 시 배정 중단 |
| 오류 처리 | 경고 메시지 | 상세한 위반 보고서 |
| 재조정 | 자동 재조정으로 위반 무시 | 재조정 로직 완전 제거 |
| 디버깅 기능 | 제한적 검증 | 체계적 7단계 디버깅 |

### 📊 검토 및 분석
- **시간표 검토**: 생성된 시간표 상세 검토
- **통계 분석**: 교사별 근무 시간, 과목별 배정 현황 등 통계 제공
- **문제점 표시**: 제약 조건 위반, 시간 충돌 등 문제점 자동 감지
- **Excel 내보내기**: 시간표를 Excel 파일로 내보내기

## 🚀 시작하기

### 설치 및 실행

1. **저장소 클론**
```bash
git clone [repository-url]
cd timetable-producer_2nd
```

2. **의존성 설치**
```bash
npm install
```

3. **개발 서버 실행**
```bash
npm start
```

4. **브라우저에서 접속**
```
http://localhost:8080
```

### 빌드

프로덕션용 빌드:
```bash
npm run build
```

## 📁 프로젝트 구조

```
timetable-producer_2nd/
├── src/
│   ├── components/          # React 컴포넌트
│   │   ├── forms/          # 폼 컴포넌트
│   │   ├── tables/         # 테이블 컴포넌트
│   │   ├── review/         # 검토 관련 컴포넌트
│   │   └── common/         # 공통 컴포넌트
│   ├── core/               # 핵심 로직 (TypeScript)
│   │   ├── scheduler.ts    # 시간표 생성 엔진
│   │   ├── constraints.ts  # 제약 조건 검증
│   │   ├── coTeaching.ts   # 공동수업 관리
│   │   └── ...
│   ├── hooks/              # React Hooks
│   ├── types/              # TypeScript 타입 정의
│   ├── utils/              # 유틸리티 함수
│   └── services/           # 서비스 로직
├── public/                 # 정적 파일
└── package.json           # 프로젝트 설정
```

## 🛠 기술 스택

### Frontend
- **React 18**: 사용자 인터페이스
- **TypeScript**: 타입 안전성
- **Tailwind CSS**: 스타일링
- **React Beautiful DnD**: 드래그 앤 드롭 기능

### Build Tools
- **Webpack**: 번들링
- **Babel**: JavaScript 컴파일
- **PostCSS**: CSS 처리

### Libraries
- **XLSX**: Excel 파일 처리
- **@dnd-kit**: 드래그 앤 드롭 (최신 버전)

## 📖 사용법

### 1. 새 시간표 만들기
1. 시작 화면에서 "새로 시작하기" 클릭
2. 단계별로 설정 정보 입력
3. 각 단계에서 "다음" 버튼으로 진행

### 2. 기존 시간표 불러오기
1. 시작 화면에서 "JSON 파일 선택" 클릭
2. 이전에 저장한 JSON 파일 선택
3. 설정된 내용으로 작업 계속

### 3. 시간표 생성
1. 모든 설정 완료 후 "시간표 생성" 단계로 이동
2. "시간표 생성 시작" 버튼 클릭
3. 생성 과정을 실시간으로 확인:
   - **1-3단계**: 기본 설정 및 고정 수업 배치
   - **4단계**: 공동수업 배치
   - **5-6a단계**: 일반 수업 배치
   - **6b단계**: 교사 시수 일치 검증 (공동수업 고려) - 교사의 총 주간시수와 학급별 요구시수를 비교하여 공동수업을 고려한 시수 일치 여부를 검증합니다.
   - **7-8단계**: 빈 슬롯 채우기 및 교사별 재조정
   - **9-12단계**: 최종 검증 및 통계 계산
4. 생성 완료 후 결과 검토

### 4. 결과 내보내기
1. "검토 및 내보내기" 단계에서 시간표 검토
2. 문제점 확인 및 수정
3. Excel 파일로 내보내기

## ⚙️ 설정 옵션

### 기본 설정
- **학년 수**: 1~6학년 설정 가능
- **학급 수**: 학년별 학급 수 개별 설정
- **일일 교시 수**: 요일별 교시 수 설정

### 과목 설정
- **과목명**: 과목 이름 입력
- **주간 시수**: 과목별 주간 수업 시간
- **특별실 필요**: 특별실이 필요한 과목 표시
- **공동수업 필요**: 여러 교사가 필요한 과목 표시

### 교사 설정
- **교사명**: 교사 이름 입력
- **담당 과목**: 교사가 담당할 과목 선택
- **주간 근무 시간**: 교사별 주간 근무 시간 제한
- **학급별 시수**: 교사별 학급 시수 세부 설정

### 제약 조건
- **필수 제약**: 반드시 지켜야 할 조건
- **선택 제약**: 가능하면 지키려는 조건

## 🔧 고급 기능

### 공동수업 관리
- 여러 교사가 함께 진행하는 수업 자동 배정
- 교사 간 시간 충돌 방지
- 공동수업 제약 조건 설정

### 교사 시간 균형
- 교사별 주간 근무 시간 자동 조정
- 과도한 근무 시간 방지
- 공정한 시간 배분

### 빈 시간 채우기
- 미배정 시간 자동 감지
- 적절한 과목으로 자동 채우기
- 제약 조건 준수하며 채우기

## 📊 출력 형식

### Excel 파일 구조
- **시트 1**: 전체 시간표 (학급별)
- **시트 2**: 교사별 시간표
- **시트 3**: 통계 정보
- **시트 4**: 문제점 목록

### JSON 저장 형식
- 모든 설정 정보 포함
- 생성된 시간표 데이터
- 메타데이터 (생성일, 수정일 등)

## 🐛 문제 해결

### 자주 발생하는 문제

1. **시간표 생성 실패 (제약조건 위반)**
   - 제약조건 위반 보고서 확인
   - 교사별 수업 가능 시간 설정 검토
   - 학급별 주간 수업 시수 조정
   - 교사 수와 과목 수의 균형 확인
   - 고정 수업 설정 재검토

2. **교사 시간 초과**
   - 교사별 주간 근무 시간 설정 확인
   - 교사별 수업 가능 시간(`available_times`) 설정
   - 담당 과목 수 조정
   - 공동수업 설정 검토

3. **특별실 충돌**
   - 특별실이 필요한 과목 수 확인
   - 특별실 사용 시간 조정
   - 과목별 우선순위 설정

4. **제약조건 위반 메시지 해석**
   - 위반된 제약조건 목록 확인
   - 권장 해결 방안 참고
   - 데이터 설정 재검토 후 재시도

### 제약조건 위반 시 해결 방법

1. **교사별 수업 가능 시간 위반**
   - 교사의 `available_times` 설정 확인
   - 불가능한 시간에 배정된 수업 제거
   - 교사 수업 가능 시간 확장 고려

2. **학급별 주간 수업 시수 초과**
   - `classWeeklyHours` 설정 확인
   - 과목별 주간 시수 조정
   - 학급별 수업 시수 제한 완화

3. **교사 시간 충돌**
   - 교사 중복 배정 확인
   - 교사별 수업 가능 시간 조정
   - 교사 수 증가 고려

## 🤝 기여하기

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요.

## 📞 지원

문제가 발생하거나 질문이 있으시면:
- GitHub Issues에 문제 등록
- 프로젝트 문서 참조
- 개발팀에 문의

---

**개발자**: 교육용 시간표 제작 시스템 개발팀  
**버전**: 1.0.0  
**최종 업데이트**: 2024년 