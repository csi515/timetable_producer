<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주간 시수 비교 테이블 테스트</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .table th,
        .table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
        }
        
        .table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-yellow-50 { background-color: #fffbeb; }
        
        .text-red-600 { color: #dc2626; }
        .text-yellow-600 { color: #d97706; }
        .text-green-600 { color: #16a34a; }
        .text-blue-600 { color: #2563eb; }
        .text-gray-600 { color: #4b5563; }
        
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        
        .text-lg { font-size: 1.125rem; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        
        .mb-4 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mr-2 { margin-right: 0.5rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .p-3 { padding: 0.75rem; }
        
        .flex { display: flex; }
        .items-center { align-items: center; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .gap-2 { gap: 0.5rem; }
        
        .overflow-x-auto { overflow-x: auto; }
        .rounded-lg { border-radius: 0.5rem; }
        
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // WeeklyHoursComparisonTable 컴포넌트
        const WeeklyHoursComparisonTable = ({ classHours, teacherHours, coTeachingClasses, data }) => {
            if (!classHours || !teacherHours) {
                return null;
            }

            // 학급별 주간 시수 계산
            const calculateClassWeeklyHours = (className) => {
                const classData = classHours[className];
                if (!classData) return 0;
                
                let totalHours = classData.totalHours || 0;
                
                // 공동수업으로 인한 추가 시수 계산
                const coTeachingForClass = coTeachingClasses?.filter(ct => 
                    ct.className === className
                ) || [];
                
                return totalHours;
            };

            // 교사별 주간 시수 계산 (공동수업 포함)
            const calculateTeacherWeeklyHours = (teacherName) => {
                const teacherData = teacherHours[teacherName];
                if (!teacherData) return 0;
                
                let totalHours = teacherData.totalHours || 0;
                
                // 공동수업으로 인한 추가 시수 계산
                const coTeachingForTeacher = coTeachingClasses?.filter(ct => 
                    ct.mainTeacher === teacherName || 
                    (ct.coTeachers && ct.coTeachers.includes(teacherName))
                ) || [];
                
                // 제약조건 기반 공동수업은 이미 teacherHours에 포함되어 있음
                // 고정수업 기반 공동수업만 추가 계산
                const fixedCoTeachingHours = coTeachingForTeacher.filter(ct => 
                    ct.source === 'fixed_class'
                ).length;
                
                return totalHours + fixedCoTeachingHours;
            };

            // 학급 목록 생성
            const getClassList = () => {
                const classes = [];
                const base = data?.base || {};
                const grades = base.grades || 0;
                const classesPerGrade = base.classes_per_grade || [];
                
                for (let grade = 1; grade <= grades; grade++) {
                    const classesInGrade = classesPerGrade[grade - 1] || 0;
                    for (let classNum = 1; classNum <= classesInGrade; classNum++) {
                        classes.push(`${grade}학년 ${classNum}반`);
                    }
                }
                return classes;
            };

            const classList = getClassList();
            const teacherList = Object.keys(teacherHours || {});

            return (
                <div className="card">
                    <h3 className="text-lg font-semibold mb-4 flex items-center">
                        <span className="mr-2">📊</span>
                        주간 시수 비교 분석
                    </h3>
                    <p className="text-sm text-gray-600 mb-4">
                        학급별 주간 시수와 교사별 주간 시수를 비교합니다. 공동수업이 있는 경우 교사 시수가 학급 시수보다 많을 수 있습니다.
                    </p>

                    <div className="overflow-x-auto">
                        <table className="table w-full">
                            <thead>
                                <tr className="bg-gray-50">
                                    <th className="text-left p-3 border">구분</th>
                                    <th className="text-center p-3 border">주간 시수</th>
                                    <th className="text-center p-3 border">목표 시수</th>
                                    <th className="text-center p-3 border">차이</th>
                                    <th className="text-center p-3 border">상태</th>
                                </tr>
                            </thead>
                            <tbody>
                                {/* 학급별 시수 요약 */}
                                <tr className="bg-blue-50">
                                    <td className="font-semibold p-3 border" colSpan="5">
                                        📚 학급별 시수 요약
                                    </td>
                                </tr>
                                {classList.map(className => {
                                    const weeklyHours = calculateClassWeeklyHours(className);
                                    const targetHours = 35; // 기본 주간 시수 (조정 가능)
                                    const difference = weeklyHours - targetHours;
                                    const status = difference > 0 ? '초과' : difference < 0 ? '부족' : '적정';
                                    const statusColor = difference > 0 ? 'text-red-600' : difference < 0 ? 'text-yellow-600' : 'text-green-600';
                                    
                                    return (
                                        <tr key={className} className="hover:bg-gray-50">
                                            <td className="p-3 border font-medium">{className}</td>
                                            <td className="p-3 border text-center">{weeklyHours}시간</td>
                                            <td className="p-3 border text-center">{targetHours}시간</td>
                                            <td className={`p-3 border text-center font-semibold ${difference > 0 ? 'text-red-600' : difference < 0 ? 'text-yellow-600' : 'text-green-600'}`}>
                                                {difference > 0 ? '+' : ''}{difference}시간
                                            </td>
                                            <td className={`p-3 border text-center font-semibold ${statusColor}`}>
                                                {status}
                                            </td>
                                        </tr>
                                    );
                                })}

                                {/* 교사별 시수 요약 */}
                                <tr className="bg-green-50">
                                    <td className="font-semibold p-3 border" colSpan="5">
                                        👨‍🏫 교사별 시수 요약 (공동수업 포함)
                                    </td>
                                </tr>
                                {teacherList.map(teacherName => {
                                    const teacher = data?.teachers?.find(t => t.name === teacherName);
                                    const weeklyHours = calculateTeacherWeeklyHours(teacherName);
                                    const targetHours = teacher?.weeklyHours || teacher?.maxHours || 25;
                                    const difference = weeklyHours - targetHours;
                                    const status = difference > 0 ? '초과' : difference < 0 ? '부족' : '적정';
                                    const statusColor = difference > 0 ? 'text-red-600' : difference < 0 ? 'text-yellow-600' : 'text-green-600';
                                    
                                    // 공동수업 참여 여부 확인
                                    const hasCoTeaching = coTeachingClasses?.some(ct => 
                                        ct.mainTeacher === teacherName || 
                                        (ct.coTeachers && ct.coTeachers.includes(teacherName))
                                    );
                                    
                                    return (
                                        <tr key={teacherName} className={`hover:bg-gray-50 ${hasCoTeaching ? 'bg-blue-50' : ''}`}>
                                            <td className="p-3 border font-medium">
                                                {teacherName}
                                                {hasCoTeaching && <span className="ml-2 text-blue-600 text-xs">🤝</span>}
                                            </td>
                                            <td className="p-3 border text-center">{weeklyHours}시간</td>
                                            <td className="p-3 border text-center">{targetHours}시간</td>
                                            <td className={`p-3 border text-center font-semibold ${difference > 0 ? 'text-red-600' : difference < 0 ? 'text-yellow-600' : 'text-green-600'}`}>
                                                {difference > 0 ? '+' : ''}{difference}시간
                                            </td>
                                            <td className={`p-3 border text-center font-semibold ${statusColor}`}>
                                                {status}
                                            </td>
                                        </tr>
                                    );
                                })}

                                {/* 전체 통계 */}
                                <tr className="bg-gray-100">
                                    <td className="font-semibold p-3 border" colSpan="5">
                                        📈 전체 통계
                                    </td>
                                </tr>
                                <tr className="bg-gray-50">
                                    <td className="p-3 border font-medium">총 학급 시수</td>
                                    <td className="p-3 border text-center font-semibold">
                                        {classList.reduce((sum, className) => sum + calculateClassWeeklyHours(className), 0)}시간
                                    </td>
                                    <td className="p-3 border text-center">
                                        {classList.length * 35}시간
                                    </td>
                                    <td className="p-3 border text-center font-semibold">
                                        {classList.reduce((sum, className) => {
                                            const weeklyHours = calculateClassWeeklyHours(className);
                                            return sum + (weeklyHours - 35);
                                        }, 0)}시간
                                    </td>
                                    <td className="p-3 border text-center">-</td>
                                </tr>
                                <tr className="bg-gray-50">
                                    <td className="p-3 border font-medium">총 교사 시수</td>
                                    <td className="p-3 border text-center font-semibold">
                                        {teacherList.reduce((sum, teacherName) => sum + calculateTeacherWeeklyHours(teacherName), 0)}시간
                                    </td>
                                    <td className="p-3 border text-center">
                                        {teacherList.reduce((sum, teacherName) => {
                                            const teacher = data?.teachers?.find(t => t.name === teacherName);
                                            return sum + (teacher?.weeklyHours || teacher?.maxHours || 25);
                                        }, 0)}시간
                                    </td>
                                    <td className="p-3 border text-center font-semibold">
                                        {teacherList.reduce((sum, teacherName) => {
                                            const teacher = data?.teachers?.find(t => t.name === teacherName);
                                            const weeklyHours = calculateTeacherWeeklyHours(teacherName);
                                            const targetHours = teacher?.weeklyHours || teacher?.maxHours || 25;
                                            return sum + (weeklyHours - targetHours);
                                        }, 0)}시간
                                    </td>
                                    <td className="p-3 border text-center">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {/* 범례 */}
                    <div className="mt-4 p-3 bg-gray-50 rounded-lg">
                        <h4 className="font-semibold mb-2">📋 범례</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                            <div className="flex items-center">
                                <span className="w-4 h-4 bg-blue-50 border mr-2"></span>
                                <span>공동수업 참여 교사</span>
                            </div>
                            <div className="flex items-center">
                                <span className="w-4 h-4 bg-green-50 border mr-2"></span>
                                <span>적정 시수</span>
                            </div>
                            <div className="flex items-center">
                                <span className="w-4 h-4 bg-yellow-50 border mr-2"></span>
                                <span>시수 부족</span>
                            </div>
                            <div className="flex items-center">
                                <span className="w-4 h-4 bg-red-50 border mr-2"></span>
                                <span>시수 초과</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 테스트 데이터
        const testData = {
            base: {
                grades: 3,
                classes_per_grade: [4, 4, 4]
            },
            teachers: [
                { name: "김교사", weeklyHours: 25, maxHours: 30 },
                { name: "이교사", weeklyHours: 22, maxHours: 28 },
                { name: "박교사", weeklyHours: 24, maxHours: 26 },
                { name: "최교사", weeklyHours: 23, maxHours: 25 }
            ]
        };

        const testClassHours = {
            "1학년 1반": { totalHours: 35 },
            "1학년 2반": { totalHours: 34 },
            "1학년 3반": { totalHours: 36 },
            "1학년 4반": { totalHours: 35 },
            "2학년 1반": { totalHours: 33 },
            "2학년 2반": { totalHours: 35 },
            "2학년 3반": { totalHours: 37 },
            "2학년 4반": { totalHours: 34 },
            "3학년 1반": { totalHours: 35 },
            "3학년 2반": { totalHours: 36 },
            "3학년 3반": { totalHours: 34 },
            "3학년 4반": { totalHours: 35 }
        };

        const testTeacherHours = {
            "김교사": { totalHours: 26 },
            "이교사": { totalHours: 20 },
            "박교사": { totalHours: 25 },
            "최교사": { totalHours: 22 }
        };

        const testCoTeachingClasses = [
            {
                className: "1학년 1반",
                mainTeacher: "김교사",
                coTeachers: ["이교사"],
                source: "fixed_class"
            },
            {
                className: "2학년 2반",
                mainTeacher: "박교사",
                coTeachers: ["최교사"],
                source: "constraint"
            }
        ];

        // 메인 앱 컴포넌트
        const App = () => {
            return (
                <div style={{ padding: '20px', maxWidth: '1200px', margin: '0 auto' }}>
                    <h1 style={{ textAlign: 'center', marginBottom: '30px', color: '#1f2937' }}>
                        🕐 시간표 제작 시스템 - 주간 시수 비교 분석
                    </h1>
                    
                    <WeeklyHoursComparisonTable 
                        classHours={testClassHours}
                        teacherHours={testTeacherHours}
                        coTeachingClasses={testCoTeachingClasses}
                        data={testData}
                    />
                </div>
            );
        };

        // React 앱 렌더링
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html> 